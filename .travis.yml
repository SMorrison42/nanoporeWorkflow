sudo: false
language: bash
before_install:
  - export PATH=$PATH:./nanopolish:./minimap2-2.17_x64-linux
  - curl -L https://github.com/lh3/minimap2/releases/download/v2.17/minimap2-2.17_x64-linux.tar.bz2 | tar -jxvf -
  - git clone --recursive https://github.com/jts/nanopolish.git && ( cd nanopolish && git checkout v0.11.1 && make -j 2 || make -j 2 || make || make ) # multithread make but single thread make just in case
  #- wget -q https://mirror.oxfordnanoportal.com/software/analysis/ont_guppy_2.2.2-1~xenial_amd64.deb && dpkg -i --ignore-depends=nvidia-384,libcuda1-384 ont_guppy_2.2.2-2~xenial_amd64.deb
  - wget https://mirror.oxfordnanoportal.com/software/analysis/ont_guppy_cpu_3.2.1-1~xenial_amd64.deb && dpkg -i --ignore-depends=nvidia-384,libcuda1-384 ont_guppy_cpu_3.2.1-1~xenial_amd64.deb
addons:
  apt:
    sources:
    - sourceline: 'ppa:duggan/bats'
    #- sourceline: 'deb http://mirror.oxfordnanoportal.com/apt xenial-stable non-free'
    packages:
    - bats
    - realpath
    - samtools
    - tabix
    - ncbi-blast+
    - gcc
    - libeigen3-dev
    - libhdf5-dev
  homebrew:
    taps: brewsci/bio
    casks:
      - wtdbg2

script: 
  - make
  - make t/np_basecall-demux_guppy.done
  - make t/np_prepSample_readLengths.sh.done
  - make t/np_assemble_wtdbg2.sh.done
  - make t/np_polish_medaka.sh.done

